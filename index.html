<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Calculadora de Importação (RS)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
      :root {
        --bg: #0f172a; /* slate-900 */
        --card: #111827; /* gray-900 */
        --muted: #9ca3af; /* gray-400 */
        --accent: #60a5fa; /* blue-400 */
        --accent-strong: #3b82f6; /* blue-500 */
        --fg: #e5e7eb; /* gray-200 */
        --ok: #22c55e;
        --warn: #f59e0b;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial,
          sans-serif;
        background: linear-gradient(180deg, #0b1220, #0f172a);
        color: var(--fg);
        padding: 24px;
      }
      .wrap {
        max-width: 900px;
        margin: 0 auto;
      }
      h1 {
        margin: 0 0 16px;
        font-size: clamp(20px, 3vw, 28px);
        letter-spacing: 0.3px;
        text-align: center;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }
      .card {
        background: linear-gradient(180deg, #0e1526, #0a1020);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 16px;
        padding: 18px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
      }
      label {
        display: block;
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 6px;
      }
      input {
        width: 100%;
        background: #0b1222;
        color: var(--fg);
        border: 1px solid rgba(255, 255, 255, 0.08);
        outline: none;
        border-radius: 10px;
        padding: 10px 12px;
        font-size: 14px;
      }
      input:focus {
        border-color: var(--accent);
      }
      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 12px;
      }
      .row-3 {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 12px;
      }
      .actions {
        display: flex;
        gap: 12px;
        margin-top: 12px;
        flex-wrap: wrap;
      }
      button {
        flex: 1;
        min-width: 180px;
        background: var(--accent-strong);
        color: white;
        border: none;
        border-radius: 10px;
        padding: 12px 14px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.05s ease, opacity 0.2s ease;
      }
      button:hover {
        opacity: 0.95;
      }
      button:active {
        transform: translateY(1px);
      }
      .btn-gray {
        background: #334155;
      }
      .btn-green {
        background: var(--ok);
      }
      .note {
        font-size: 12px;
        color: var(--muted);
        margin-top: 6px;
        line-height: 1.4;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        border: 1px solid rgba(255, 255, 255, 0.08);
        overflow: hidden;
        border-radius: 12px;
        background: #0b1222;
      }
      th,
      td {
        padding: 10px 12px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        font-size: 14px;
      }
      th {
        text-align: left;
        background: #0e172d;
        color: #c7d2fe;
        font-weight: 700;
      }
      tr:last-child td {
        border-bottom: 0;
      }
      .muted {
        color: var(--muted);
      }
      .ok {
        color: var(--ok);
        font-weight: 700;
      }
      .warn {
        color: var(--warn);
        font-weight: 700;
      }
      .strong {
        font-weight: 800;
      }
      .titlebar {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        align-items: center;
        margin-bottom: 10px;
      }
      .tag {
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 999px;
        background: rgba(59, 130, 246, 0.15);
        color: #93c5fd;
        border: 1px solid rgba(59, 130, 246, 0.35);
      }
      #printArea {
        padding: 8px;
      }
      @media (max-width: 860px) {
        .grid {
          grid-template-columns: 1fr;
        }
        .row,
        .row-3 {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>Calculadora de Importação — RS</h1>

      <div class="grid">
        <div class="card">
          <div class="titlebar">
            <div class="tag">Entrada</div>
            <small class="muted">Simulação para remessas postais</small>
          </div>

          <div class="row">
            <div>
              <label for="titulo">Título do produto</label>
              <input id="titulo" placeholder="Ex: Tênis X" />
            </div>
            <div>
              <label for="valorYuan">Valor do produto (¥ yuan)</label>
              <input
                id="valorYuan"
                type="number"
                step="0.01"
                placeholder="Ex: 200"
              />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="peso">Peso (g)</label>
              <input id="peso" type="number" step="1" placeholder="Ex: 800" />
            </div>
            <div>
              <label for="cotacaoYuan"
                >Cotação Yuan —
                <span class="muted">1 real = X yuan</span></label
              >
              <input
                id="cotacaoYuan"
                type="number"
                step="0.01"
                placeholder="Ex: 1.20"
              />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="declaradoUSD">Valor declarado (US$)</label>
              <input
                id="declaradoUSD"
                type="number"
                step="0.01"
                placeholder="Ex: 10.00"
              />
            </div>
            <div>
              <label for="usdBrl"
                >Cotação USD — <span class="muted">1 US$ = R$</span></label
              >
              <input
                id="usdBrl"
                type="number"
                step="0.01"
                placeholder="Ex: 5.30"
              />
            </div>
          </div>

          <div class="row-3">
            <div>
              <label for="aliquotaII">II (%)</label>
              <input id="aliquotaII" type="number" step="0.01" value="60" />
            </div>
            <div>
              <label for="aliquotaICMS">ICMS RS (%)</label>
              <input id="aliquotaICMS" type="number" step="0.01" value="17" />
            </div>
            <div>
              <label for="despacho">Despacho Postal (R$)</label>
              <input id="despacho" type="number" step="0.01" value="15" />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="margem">Margem para Cliente (%)</label>
              <input id="margem" type="number" step="0.01" value="50" />
            </div>
            <div>
              <label>&nbsp;</label>
              <div class="note">
                Ex.: 50% — calcula lucro e preço final ao cliente.
              </div>
            </div>
          </div>

          <div class="actions">
            <button id="calcular" class="btn-green">Calcular</button>
            <button id="baixarPdf">Baixar PDF</button>
            <button id="baixarPng" class="btn-gray">Baixar PNG</button>
          </div>
          <div class="note">
            Dica: costuma declarar US$ 10–12 para tênis? Preenche em
            <strong>Valor declarado (US$)</strong> e ajusta as alíquotas se
            precisar.
          </div>
        </div>

        <div class="card">
          <div class="titlebar">
            <div class="tag">Resultado</div>
            <small class="muted">Pronto pra print/PDF</small>
          </div>

          <div id="printArea">
            <table
              id="tabelaResultado"
              style="display: none; margin-bottom: 16px"
            >
              <thead>
                <tr>
                  <th colspan="2" id="thTitulo">Comprovante de Custo</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="muted">Produto</td>
                  <td id="outProduto"></td>
                </tr>
                <tr>
                  <td class="muted">Valor do produto</td>
                  <td id="outProdutoValores"></td>
                </tr>
                <tr>
                  <td class="muted">Peso</td>
                  <td id="outPeso"></td>
                </tr>
                <tr>
                  <td class="muted">Cotações</td>
                  <td id="outCotas"></td>
                </tr>
                <tr>
                  <td class="muted">Declaração</td>
                  <td id="outDeclaracao"></td>
                </tr>
                <tr>
                  <td class="muted">Imposto de Importação (II)</td>
                  <td id="outII"></td>
                </tr>
                <tr>
                  <td class="muted">ICMS RS</td>
                  <td id="outICMS"></td>
                </tr>
                <tr>
                  <td class="muted">Despacho Postal</td>
                  <td id="outDespacho"></td>
                </tr>
                <tr>
                  <td class="strong">Total Impostos/Despesas</td>
                  <td class="warn" id="outTotImp"></td>
                </tr>
                <tr>
                  <td class="strong">Total Desembolso</td>
                  <td class="ok" id="outTotal"></td>
                </tr>
              </tbody>
            </table>

            <table id="tabelaCliente" style="display: none">
              <thead>
                <tr>
                  <th colspan="2" id="thCliente">Proposta ao Cliente</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="muted">Custo do Produto (R$)</td>
                  <td id="clCustoProduto"></td>
                </tr>
                <tr>
                  <td class="muted">Impostos + Despesas (R$)</td>
                  <td id="clImpostos"></td>
                </tr>
                <tr>
                  <td class="strong">Custo Total (R$)</td>
                  <td class="strong" id="clCustoTotal"></td>
                </tr>
                <tr>
                  <td class="muted">Margem (%)</td>
                  <td id="clMargem"></td>
                </tr>
                <tr>
                  <td class="muted">Lucro (R$)</td>
                  <td id="clLucro"></td>
                </tr>
                <tr>
                  <td class="strong">Preço ao Cliente (R$)</td>
                  <td class="ok" id="clPreco"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div id="placeholder" class="muted">
            Preencha os campos e clique <strong>Calcular</strong> pra ver o
            resultado aqui.
          </div>
        </div>
      </div>
    </div>

    <script>
      const fmtBRL = (v) =>
        v.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
      const fmtYuan = (v) => `${v.toFixed(2)} ¥`;
      const fmtUSD = (v) =>
        v.toLocaleString("en-US", { style: "currency", currency: "USD" });

      function calcular() {
        const titulo = $("#titulo").val().trim() || "Produto";
        const valorYuan = parseFloat($("#valorYuan").val()) || 0;
        const peso = parseFloat($("#peso").val()) || 0;
        const cotacaoYuan = parseFloat($("#cotacaoYuan").val()) || 1;
        const declaradoUSD = parseFloat($("#declaradoUSD").val()) || 0;
        const usdBrl = parseFloat($("#usdBrl").val()) || 0;
        const aliqIIp = parseFloat($("#aliquotaII").val()) || 60;
        const aliqICMSp = parseFloat($("#aliquotaICMS").val()) || 17;
        const despacho = parseFloat($("#despacho").val()) || 15;
        const margemP = parseFloat($("#margem").val()) || 50;

        const brlPorYuan = 1 / cotacaoYuan;
        const produtoBRL = valorYuan * brlPorYuan;

        const declaracaoBRL = declaradoUSD * usdBrl;

        const rII = aliqIIp / 100;
        const rICMS = aliqICMSp / 100;

        const II = rII * declaracaoBRL;
        const ICMS =
          rICMS > 0
            ? (rICMS * (declaracaoBRL + II + despacho)) / (1 - rICMS)
            : 0;

        const totalImpostos = II + ICMS + despacho;
        const totalDesembolso = produtoBRL + totalImpostos;

        const margem = margemP / 100;
        const lucro = totalDesembolso * margem;
        const precoCliente = totalDesembolso + lucro;

        $("#thTitulo").text(`Comprovante de Custo — ${titulo}`);
        $("#outProduto").text(titulo);

        const produtoStr = `${fmtYuan(valorYuan)}  •  ${fmtBRL(produtoBRL)}`;
        $("#outProdutoValores").text(produtoStr);

        $("#outPeso").text(`${isFinite(peso) ? peso : 0} g`);
        $("#outCotas").html(
          `1 R$ = ${cotacaoYuan || 0} ¥  •  1 US$ = ${fmtBRL(usdBrl || 0)}`
        );
        $("#outDeclaracao").text(
          `${fmtUSD(declaradoUSD)}  •  ${fmtBRL(declaracaoBRL)}`
        );
        $("#outII").text(`${fmtBRL(II)}  (${aliqIIp.toFixed(2)}%)`);
        $("#outICMS").text(`${fmtBRL(ICMS)}  (${aliqICMSp.toFixed(2)}%)`);
        $("#outDespacho").text(fmtBRL(despacho));
        $("#outTotImp").text(fmtBRL(totalImpostos));
        $("#outTotal").text(fmtBRL(totalDesembolso));

        $("#thCliente").text(`Proposta ao Cliente — ${titulo}`);
        $("#clCustoProduto").text(fmtBRL(produtoBRL));
        $("#clImpostos").text(fmtBRL(totalImpostos));
        $("#clCustoTotal").text(fmtBRL(totalDesembolso));
        $("#clMargem").text(`${margemP.toFixed(2)}%`);
        $("#clLucro").text(fmtBRL(lucro));
        $("#clPreco").text(fmtBRL(precoCliente));

        $("#placeholder").hide();
        $("#tabelaResultado, #tabelaCliente").show();

        return {
          titulo,
          valorYuan,
          peso,
          cotacaoYuan,
          brlPorYuan,
          produtoBRL,
          declaradoUSD,
          usdBrl,
          declaracaoBRL,
          II,
          ICMS,
          despacho,
          totalImpostos,
          totalDesembolso,
          margemP,
          lucro,
          precoCliente,
        };
      }

      $(function () {
        $("#calcular").on("click", calcular);

        $("#baixarPdf").on("click", async function () {
          if ($("#tabelaResultado").is(":hidden")) calcular();

          const { jsPDF } = window.jspdf;
          const doc = new jsPDF({ unit: "mm", format: "a4" });

          doc.setFont("helvetica", "bold");
          doc.setFontSize(14);
          doc.text("Comprovante de Custo de Importação", 14, 16);

          await doc.html(document.querySelector("#printArea"), {
            x: 10,
            y: 24,
            width: 190,
            windowWidth: 900,
          });

          doc.save("comprovante_importacao.pdf");
        });

        $("#baixarPng").on("click", async function () {
          if ($("#tabelaResultado").is(":hidden")) calcular();

          const node = document.querySelector("#printArea");
          const canvas = await html2canvas(node, {
            scale: 2,
            backgroundColor: "#0b1222",
          });
          const dataUrl = canvas.toDataURL("image/png");

          const a = document.createElement("a");
          a.href = dataUrl;
          a.download = "comprovante_importacao.png";
          document.body.appendChild(a);
          a.click();
          a.remove();
        });
      });
    </script>
  </body>
</html>
